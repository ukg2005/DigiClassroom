{% extends 'users/base.html' %}

{% block content %}
<h3>Submission Detail</h3>
<p><strong>Student:</strong> {{ submission.student.username }}</p>
<p><strong>Assignment:</strong> {{ submission.assignment.title }}</p>
<p><strong>Score:</strong> {{ submission.score }}</p>

<h4>Feedback</h4>
{% if is_teacher %}
<form method="post">
    {% csrf_token %}
    <textarea name="feedback" class="form-control" rows="3" placeholder="Leave feedback...">{{ submission.teacher_feedback|default:'' }}</textarea>
    <button type="submit" class="btn btn-primary mt-2">Update Feedback</button>
</form>
{% else %}
<div class="alert alert-secondary">
    {{ submission.teacher_feedback|default:"No feedback yet." }}
</div>
{% endif %}

<h4 class="mt-4">Answers</h4>
<ul class="list-group">
    {% for ans in answers %}
        <li class="list-group-item">
            <p class="mb-1"><strong>{{ ans.question.text }}</strong></p>
            <p class="mb-0 {% if ans.selected_choice.is_correct %}text-success{% else %}text-danger{% endif %}">
                Selected: {{ ans.selected_choice.text }} 
                {% if ans.selected_choice.is_correct %}(Correct){% else %}(Incorrect){% endif %}
            </p>
        </li>
    {% endfor %}
</ul>
<div class="mt-3">
    {% if is_teacher %}
         <a href="{% url 'view_submissions' submission.assignment.pk %}" class="btn btn-secondary">Back to Submissions</a>
    {% else %}
         <a href="{% url 'assignment_detail' submission.assignment.pk %}" class="btn btn-secondary">Back to Assignment</a>
    {% endif %}
</div>
{% endblock %}
